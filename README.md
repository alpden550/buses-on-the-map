# Автобусы на карте Москвы

Веб-приложение показывает передвижение автобусов на карте Москвы.

<img src="screenshots/buses.gif">

## Как запустить

- Скачайте код
- Установите зависимости

Если установлен Poetry:

```bash
poetry install
```

Иначе рекомендуется использовать виртуальное окружение для изоляции зависимостей:

```bash
pip install -r requirements.txt
```

Чтобы запустить сервер:

```bash
python server.py
```

Чтобы узнать все доступные опции для старта сервера:

```bash
python server.py --help
```

После старта сервера запустите эмулятор автобусов:

```bash
python fake_bus.py
```

Чтобы узнать все доступные опции для старта эмулятора автобусов':

```bash
python fake_bus.py --help
```

Открыть файл index.html в браузере.

## Настройки

Внизу справа на странице можно включить отладочный режим логгирования и указать нестандартный адрес веб-сокета.

<img src="screenshots/settings.png">

Настройки сохраняются в Local Storage браузера и не пропадают после обновления страницы. Чтобы сбросить настройки удалите ключи из Local Storage с помощью Chrome Dev Tools —> Вкладка Application —> Local Storage.

Если что-то работает не так, как ожидалось, то начните с включения отладочного режима логгирования.

## Формат данных

Фронтенд ожидает получить от сервера JSON сообщение со списком автобусов:

```js
{
  "msgType": "Buses",
  "buses": [
    {"busId": "c790сс", "lat": 55.7500, "lng": 37.600, "route": "120"},
    {"busId": "a134aa", "lat": 55.7494, "lng": 37.621, "route": "670к"},
  ]
}
```

Те автобусы, что не попали в список `buses` последнего сообщения от сервера будут удалены с карты.

Фронтенд отслеживает перемещение пользователя по карте и отправляет на сервер новые координаты окна:

```js
{
  "msgType": "newBounds",
  "data": {
    "east_lng": 37.65563964843751,
    "north_lat": 55.77367652953477,
    "south_lat": 55.72628839374007,
    "west_lng": 37.54440307617188,
  },
}
```


## Тестирование

Запустить тесты валидации:

```bash
pytest
```

## Docker

Запустить сервер:

```bash
docker-compose up -d
```

Запустить автобусы:

 ```bash
 docker-compose exec server python fake_bus.py
 ```